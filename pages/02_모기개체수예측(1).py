import streamlit as st
import pandas as pd

# ------------------------------
# ğŸ¯ í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
# ------------------------------
st.set_page_config(
    page_title="ğŸ¦Ÿ ì˜ˆì¸¡ vs ì‹¤ì œ ë¹„êµ",
    layout="centered"
)

st.title("ğŸ”®ğŸ¦Ÿ 2024ë…„ ëª¨ê¸° ê°œì²´ìˆ˜ ì˜ˆì¸¡ vs ì‹¤ì œ ë¹„êµ")

# ------------------------------
# ğŸ“ ê¸°ì¡´ CSV ë°ì´í„° ë¡œë“œ
# ------------------------------
url = "year_month_mosquito_sum.csv"
df = pd.read_csv(url, header=1, encoding='cp949')
df.columns = ['ì—°ë„', 'ì›”', 'ëª¨ê¸°ê³„']
df[['ì—°ë„', 'ì›”', 'ëª¨ê¸°ê³„']] = df[['ì—°ë„', 'ì›”', 'ëª¨ê¸°ê³„']].astype(int)

# ------------------------------
# ğŸ”¢ ìµœê·¼ ëª‡ ë…„ í‰ê· ìœ¼ë¡œ ì˜ˆì¸¡í• ì§€ ì„ íƒ
# ------------------------------
N = st.slider("ìµœê·¼ ëª‡ ë…„ ë°ì´í„°ë¡œ ì˜ˆì¸¡í• ê¹Œìš”?", 1, 10, 5)
recent_start = df['ì—°ë„'].max() - N + 1
recent_df = df[df['ì—°ë„'] >= recent_start]

# ------------------------------
# âœ… 2024ë…„ ì˜ˆì¸¡ê°’ ê³„ì‚°
# ------------------------------
pred = recent_df.groupby('ì›”')['ëª¨ê¸°ê³„'].mean().round().astype(int).reset_index()
pred['ì—°ë„'] = 2024

# ------------------------------
# âœ… ì‹¤ì œ 2024 ë°ì´í„° (ìˆ˜ë™ ì…ë ¥ ì˜ˆì‹œ)
# ------------------------------
# ì‹¤ì œë¡œëŠ” ì—¬ê¸° globë¡œ ì—¬ëŸ¬ Excelì„ ì½ì–´ í•©ì¹  ìˆ˜ ìˆìŒ.
# glob, os ëª¨ë“ˆ ì‚¬ìš© ì‹œ íŒŒì¼ëª…, ê²½ë¡œ, í—¤ë”í–‰ ë“± ì¡°ì‹¬!

real = pd.DataFrame({
    'ì—°ë„': [2024]*8,
    'ì›”': list(range(4, 12)),
    'ëª¨ê¸°ê³„': [1200, 1500, 1800, 2200, 3000, 2800, 1900, 800]  # ì‹¤ì œê°’ ì˜ˆì‹œ
})

# ------------------------------
# âœ… ë¹„êµ í‘œ ë§Œë“¤ê¸°
# ------------------------------
comp = pd.merge(pred, real, on=['ì—°ë„', 'ì›”'], how='outer', suffixes=('_ì˜ˆì¸¡', '_ì‹¤ì œ')).sort_values('ì›”')

st.subheader("ğŸ“Š 2024ë…„ ì˜ˆì¸¡ vs ì‹¤ì œ ëª¨ê¸° ê°œì²´ìˆ˜")
st.dataframe(comp)

# ------------------------------
# âœ… ìˆ˜í•™ ì›ë¦¬ ì„¤ëª…
# ------------------------------
st.markdown(f"""
### ğŸ“ ì˜ˆì¸¡ ìˆ˜ì‹ ì„¤ëª…

2024ë…„ ì˜ˆì¸¡ê°’ì€ ì•„ë˜ ê³µì‹ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.

