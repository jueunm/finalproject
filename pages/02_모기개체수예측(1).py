import streamlit as st
import pandas as pd

# ------------------------------
# 🎯 페이지 기본 설정
# ------------------------------
st.set_page_config(
    page_title="🦟 예측 vs 실제 비교",
    layout="centered"
)

st.title("🔮🦟 2024년 모기 개체수 예측 vs 실제 비교")

# ------------------------------
# 📁 기존 CSV 데이터 로드
# ------------------------------
url = "year_month_mosquito_sum.csv"
df = pd.read_csv(url, header=1, encoding='cp949')
df.columns = ['연도', '월', '모기계']
df[['연도', '월', '모기계']] = df[['연도', '월', '모기계']].astype(int)

# ------------------------------
# 🔢 최근 몇 년 평균으로 예측할지 선택
# ------------------------------
N = st.slider("최근 몇 년 데이터로 예측할까요?", 1, 10, 5)
recent_start = df['연도'].max() - N + 1
recent_df = df[df['연도'] >= recent_start]

# ------------------------------
# ✅ 2024년 예측값 계산
# ------------------------------
pred = recent_df.groupby('월')['모기계'].mean().round().astype(int).reset_index()
pred['연도'] = 2024

# ------------------------------
# ✅ 실제 2024 데이터 (수동 입력 예시)
# ------------------------------
# 실제로는 여기 glob로 여러 Excel을 읽어 합칠 수 있음.
# glob, os 모듈 사용 시 파일명, 경로, 헤더행 등 조심!

real = pd.DataFrame({
    '연도': [2024]*8,
    '월': list(range(4, 12)),
    '모기계': [1200, 1500, 1800, 2200, 3000, 2800, 1900, 800]  # 실제값 예시
})

# ------------------------------
# ✅ 비교 표 만들기
# ------------------------------
comp = pd.merge(pred, real, on=['연도', '월'], how='outer', suffixes=('_예측', '_실제')).sort_values('월')

st.subheader("📊 2024년 예측 vs 실제 모기 개체수")
st.dataframe(comp)

# ------------------------------
# ✅ 수학 원리 설명
# ------------------------------
st.markdown(f"""
### 📐 예측 수식 설명

2024년 예측값은 아래 공식으로 계산됩니다.

