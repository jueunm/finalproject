import streamlit as st
import pandas as pd
import plotly.express as px

# ------------------------
# ğŸ‰ í˜ì´ì§€ íƒ€ì´í‹€ & ì„¤ëª…
# ------------------------

st.set_page_config(
    page_title="ğŸ¦Ÿ ì›”ë³„ í‰ê·  ëª¨ê¸° ê°œì²´ìˆ˜ ë¶„ì„",
    page_icon="ğŸ¦Ÿ",
    layout="wide"
)

st.title("ğŸ“Šâœ¨ ì›”ë³„ í‰ê·  ëª¨ê¸° ê°œì²´ìˆ˜ ë¶„ì„(2008~2023) âœ¨ğŸ¦Ÿ")
st.markdown(
    """
    ## ğŸ“… ì›”ë³„ í‰ê·  ëª¨ê¸° íŠ¸ë Œë“œ
    ëª¨ê¸° ê°œì²´ìˆ˜ëŠ” ê³„ì ˆê³¼ ì˜¨ë„ì— ë”°ë¼ ì–´ë–»ê²Œ ë³€í• ê¹Œìš”?  
    ëª¨ë“  ì—°ë„ì˜ ë°ì´í„°ë¥¼ ëª¨ì•„ **ì›”ë³„ í‰ê·  ëª¨ê¸° ê°œì²´ìˆ˜**ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”! ğŸŒ™ğŸŒ

    ---
    """
)

# ------------------------
# ğŸ“ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
# ------------------------

url = "ì—°ë„ë³„_ì›”ë³„_ëª¨ê¸°_ê°œì²´ìˆ˜_í•©ê³„.csv"  # ğŸ‘‰ ê¹ƒí—ˆë¸Œ raw URLë¡œ ë³€ê²½ ê°€ëŠ¥
df = pd.read_csv(url, header=1, encoding='cp949')

# ì»¬ëŸ¼ëª… & íƒ€ì… ì •ë¦¬
df.columns = ['ì—°ë„', 'ì›”', 'ëª¨ê¸°ê³„']
df['ì—°ë„'] = df['ì—°ë„'].astype(int)
df['ì›”'] = df['ì›”'].astype(int)
df['ëª¨ê¸°ê³„'] = df['ëª¨ê¸°ê³„'].astype(int)

# ------------------------
# ğŸ§® ì›”ë³„ í‰ê·  ê³„ì‚°
# ------------------------

monthly_avg = df.groupby('ì›”')['ëª¨ê¸°ê³„'].mean().reset_index()
monthly_avg['ëª¨ê¸°ê³„'] = monthly_avg['ëª¨ê¸°ê³„'].round().astype(int)

# ------------------------
# ğŸ“ˆ Plotly ë¼ì¸ ê·¸ë˜í”„
# ------------------------

fig = px.line(
    monthly_avg,
    x='ì›”',
    y='ëª¨ê¸°ê³„',
    markers=True,
    title="ğŸŒ¿ğŸ¦Ÿ ì›”ë³„ í‰ê·  ëª¨ê¸° ê°œì²´ìˆ˜ ë³€í™” ğŸ—“ï¸",
    labels={
        'ì›”': 'ì›”',
        'ëª¨ê¸°ê³„': 'í‰ê·  ëª¨ê¸° ê°œì²´ìˆ˜'
    },
    template='plotly_white'
)

fig.update_layout(
    xaxis=dict(tickmode='linear', dtick=1),
    yaxis=dict(title='í‰ê·  ëª¨ê¸° ê°œì²´ìˆ˜'),
    hovermode='x unified',
    title_x=0.5
)

# ------------------------
# âœ… Streamlit ì¶œë ¥
# ------------------------

st.plotly_chart(fig, use_container_width=True)

# ------------------------
# ğŸ“Š ë°ì´í„°í”„ë ˆì„ ë³´ê¸°
# ------------------------

with st.expander("ğŸ” ğŸ“‹ ì›”ë³„ í‰ê·  ëª¨ê¸° ê°œì²´ìˆ˜ í‘œ ë³´ê¸°"):
    st.dataframe(monthly_avg.style.highlight_max(axis=0, color='lightgreen'))

# ------------------------
# â„¹ï¸ ì¶”ê°€ ì •ë³´
# ------------------------

st.info("ğŸ’¡ **TIP:** ë´„ê³¼ ì—¬ë¦„ì² ì— ëª¨ê¸° ê°œì²´ìˆ˜ê°€ ì¦ê°€í•˜ë¯€ë¡œ ì˜ˆë°©ì— ì£¼ì˜í•˜ì„¸ìš”! ğŸ§´ğŸ¦Ÿ")
