import streamlit as st
import pandas as pd

st.set_page_config(page_title="ğŸ¦Ÿ 2024ë…„ ëª¨ê¸° ì˜ˆì¸¡ vs ì‹¤ì œ ë¹„êµ", layout="centered")
st.title("ğŸ”® 2024ë…„ ëª¨ê¸° ê°œì²´ìˆ˜ ì˜ˆì¸¡ vs ì‹¤ì œ ë¹„êµ")

df = pd.read_csv("ì—°ë„ë³„_ì›”ë³„_ëª¨ê¸°_ê°œì²´ìˆ˜_í•©ê³„.csv", header=1, encoding='cp949')
df.columns = ['ì—°ë„', 'ì›”', 'ëª¨ê¸°ê³„']
df[['ì—°ë„', 'ì›”', 'ëª¨ê¸°ê³„']] = df[['ì—°ë„', 'ì›”', 'ëª¨ê¸°ê³„']].astype(int)

N = st.slider("ìµœê·¼ ëª‡ ë…„ ë°ì´í„°ë¡œ í‰ê·  ì˜ˆì¸¡í• ê¹Œìš”?", 1, 10, 5)
recent_start = df['ì—°ë„'].max() - N + 1
recent_df = df[df['ì—°ë„'] >= recent_start]

pred = recent_df.groupby('ì›”')['ëª¨ê¸°ê³„'].mean().round().astype(int).reset_index()
pred['ì—°ë„'] = 2024

real_dict = {
    4: 214, 5: 858, 6: 2034, 7: 2511, 8: 2146,
    9: 2285, 10: 5087, 11: 1862
}
real = pd.DataFrame({
    'ì—°ë„': 2024,
    'ì›”': list(real_dict.keys()),
    'ëª¨ê¸°ê³„': list(real_dict.values())
})

comp = pd.merge(pred, real, on=['ì—°ë„', 'ì›”'], how='outer', suffixes=('_ì˜ˆì¸¡', '_ì‹¤ì œ')).sort_values('ì›”')

comp['ì˜¤ì°¨(ì‹¤ì œ-ì˜ˆì¸¡)'] = comp['ëª¨ê¸°ê³„_ì‹¤ì œ'] - comp['ëª¨ê¸°ê³„_ì˜ˆì¸¡']
comp['ì˜¤ì°¨ìœ¨(%)'] = (comp['ì˜¤ì°¨(ì‹¤ì œ-ì˜ˆì¸¡)'].abs() / comp['ëª¨ê¸°ê³„_ì‹¤ì œ'] * 100).round(2)

st.subheader(f"ğŸ“Š 2024ë…„ ëª¨ê¸° ê°œì²´ìˆ˜ ì˜ˆì¸¡ vs ì‹¤ì œ ë¹„êµ (ìµœê·¼ {N}ë…„ í‰ê·  ê¸°ì¤€)")
st.dataframe(comp.style.format({
    'ëª¨ê¸°ê³„_ì˜ˆì¸¡': '{:,}', 'ëª¨ê¸°ê³„_ì‹¤ì œ': '{:,}',
    'ì˜¤ì°¨(ì‹¤ì œ-ì˜ˆì¸¡)': '{:,}', 'ì˜¤ì°¨ìœ¨(%)': '{:.2f}%'
}))

st.markdown(f"""
### ğŸ§® ì˜ˆì¸¡ ìˆ˜ì‹

2024ë…„ ê° ì›”ì˜ ëª¨ê¸° ê°œì²´ìˆ˜ ì˜ˆì¸¡ê°’ì€ ìµœê·¼ {N}ë…„ ë™ì•ˆ í•´ë‹¹ ì›”ì˜ í‰ê·  ëª¨ê¸° ê°œì²´ìˆ˜ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤:

$$
E_{{2024,m}} = \\frac{{1}}{{{N}}} \\sum_{{y={recent_start}}}^{{2023}} X_{{y,m}}
$$

- $E_{{2024,m}}$: 2024ë…„ mì›”ì˜ ì˜ˆì¸¡ ëª¨ê¸° ê°œì²´ìˆ˜  
- $N$: ìµœê·¼ {N}ë…„  
- $X_{{y,m}}$: yë…„ë„ mì›”ì˜ ì‹¤ì œ ëª¨ê¸° ê°œì²´ìˆ˜  

### âœ… ì‹¤ì œ ë°ì´í„°  
2024ë…„ 4ì›”ë¶€í„° 11ì›”ê¹Œì§€ ì„œìš¸ ì—´ë¦°ë°ì´í„°ê´‘ì¥ì—ì„œ ì œê³µëœ ìœ ë¬¸ë“± ì±„ì§‘ ëª¨ê¸° ê°œì²´ìˆ˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§ì ‘ ì…ë ¥í–ˆìŠµë‹ˆë‹¤.
""")
